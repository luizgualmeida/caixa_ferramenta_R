# Lista 8.1: ModeraÃ§Ã£o e MediaÃ§Ã£o {.unnumbered}

::: {.callout-note appearance="simple" icon=false}
## Objetivo da Lista

Explore **anÃ¡lise de mediaÃ§Ã£o** usando SEM: compreenda efeitos diretos vs indiretos, teste hipÃ³teses de mediaÃ§Ã£o e interprete modelos causais complexos. Aprenda quando uma variÃ¡vel **medeia** (explica como) vs **modera** (modifica quando/para quem).
:::

---

## ğŸ“š MediaÃ§Ã£o vs ModeraÃ§Ã£o

::: {.callout-tip}
## Conceitos Fundamentais

**MediaÃ§Ã£o** (Como? Por que?)
- **M explica o mecanismo** entre X â†’ Y
- X influencia M, que influencia Y
- "X afeta Y **atravÃ©s de** M"

**ModeraÃ§Ã£o** (Quando? Para quem?)
- **M modifica a forÃ§a/direÃ§Ã£o** de X â†’ Y
- X Ã— M interage para afetar Y
- "O efeito de X em Y **depende de** M"

**Exemplo MediaÃ§Ã£o:**
- ExercÃ­cio â†’ Bem-estar â†’ Produtividade
- "ExercÃ­cio aumenta produtividade *porque* melhora bem-estar"

**Exemplo ModeraÃ§Ã£o:**
- Estresse Ã— Suporte Social â†’ SaÃºde Mental
- "Estresse afeta saÃºde *diferentemente* dependendo do suporte"
:::

---

## ğŸ“¦ Pacotes

```{r}
#| echo: false
#| message: false
#| warning: false

pacotes <- c(
  "foreign", "tidyverse", "lavaan", "semPlot",
  "performance", "easystats", "kableExtra",
  "mediation", "flexplot"
)

pacotes_faltantes <- pacotes[!pacotes %in% installed.packages()[, "Package"]]
if (length(pacotes_faltantes) > 0) {
  install.packages(pacotes_faltantes, dependencies = TRUE)
}

invisible(lapply(pacotes, library, character.only = TRUE))
cat("âœ“ Pacotes de mediaÃ§Ã£o carregados!\n")
```

---

## ğŸ“– Contexto do Estudo

::: {.callout-tip}
## HipÃ³tese TeÃ³rica

**VariÃ¡veis:**
- `Sociabilidade`: Escore de questionÃ¡rio (X)
- `IMC1`: Ãndice de Massa Corporal (M - mediador?)
- `Treinos`: NÃºmero de treinos/mÃªs (Y)
- `Idade`: Anos (covariÃ¡vel)

**HipÃ³tese:**
"**Sociabilidade** aumenta **Treinos**, mas esse efeito Ã© **mediado por IMC**"

Ou seja: Pessoas mais sociÃ¡veis frequentam mais a academia **porque** isso afeta seu IMC?
:::

---

## ğŸ“¥ Carregar Dados

```{r}
#| echo: true
#| message: false
#| warning: false

dados <- read.spss("DADOS PATH.sav", to.data.frame = TRUE)
glimpse(dados)
```

---

## ğŸ¯ Modelo 1: IMC como Mediador

### Diagrama Conceitual

```
Sociabilidade â†’ IMC1 â†’ Treinos
       \________________/
         (efeito direto c')
```

::: {.callout-note}
## Terminologia de MediaÃ§Ã£o

**Caminho a:** X â†’ M (Sociabilidade â†’ IMC)  
**Caminho b:** M â†’ Y (IMC â†’ Treinos)  
**Caminho c':** X â†’ Y direto (efeito apÃ³s controlar M)  
**Caminho c:** X â†’ Y total (sem M no modelo)

**Efeito Indireto:** a Ã— b  
**Efeito Total:** c = c' + (a Ã— b)

**MediaÃ§Ã£o completa:** c' = 0 (todo efeito via M)  
**MediaÃ§Ã£o parcial:** c' â‰  0 (parte do efeito Ã© direto)
:::

---

### Especificar Modelo

```{r}
#| echo: true

modelo_med1 <- "
  # RegressÃµes
  Treinos ~ c_*Sociabilidade + b*IMC1
  IMC1 ~ a*Sociabilidade
  
  # Efeitos calculados
  Indireto := a*b
  Total := a*b + c_
"
```

---

### Ajustar com Bootstrap

```{r}
#| echo: true
#| message: false
#| warning: false

fit_med1 <- sem(
  modelo_med1,
  data = dados,
  se = "bootstrap",
  bootstrap = 500
)
```

::: {.callout-tip}
## Por que Bootstrap?

**Efeitos indiretos** (a Ã— b) nÃ£o tÃªm distribuiÃ§Ã£o normal!

Bootstrap:
- Reamostra dados 500Ã— com reposiÃ§Ã£o
- Calcula a Ã— b em cada amostra
- IC baseado em distribuiÃ§Ã£o empÃ­rica

**Mais robusto** que mÃ©todo de Sobel para mediaÃ§Ã£o.
:::

---

### Resultados

```{r}
#| echo: true

parameterEstimates(fit_med1) %>%
  dplyr::select(lhs, op, rhs, label, est, se, z,  pvalue, ci.lower, ci.upper) %>%
  kable(
    digits = 3,
    col.names = c("VD", "â†", "VI", "Param", "Î²", "EP", "z", "p", "IC_low", "IC_up"),
    caption = "Estimativas do Modelo de MediaÃ§Ã£o 1"
  )
```

---

### InterpretaÃ§Ã£o - Modelo 1

::: {.callout-warning}
## ğŸ“Š Resultado: MediaÃ§Ã£o NÃƒO Confirmada

**Caminhos:**
- **a (Soc â†’ IMC):** Î² = 0.019, p = 0.693 â†’ **NS**
- **b (IMC â†’ Treino):** Î² = -1.650, p = 0.100 â†’ **NS**
- **c' (Soc â†’ Treino direto):** Î² = 0.605, p = 0.360 â†’ **NS**

**Efeito Indireto:** Î² = -0.031, p = 0.717 â†’ **NS**

**ConclusÃ£o:**
IMC **NÃƒO medeia** a relaÃ§Ã£o entre Sociabilidade e Treinos.

**Modelo teÃ³rico nÃ£o se sustenta!**
:::

---

### Diagrama do Modelo 1

```{r}
#| echo: true
#| fig-width: 8
#| fig-height: 6

semPaths(
  fit_med1,
  what = "std",
  whatLabels = "std",
  style = "ram",
  layout = "tree",
  rotation = 2,
  sizeMan = 7,
  edge.label.cex = 1,
  label.cex = 1.2,
  color = list(man = "lightblue")
)
```

---

## ğŸ” ComparaÃ§Ã£o: SEM vs RegressÃµes Separadas

### RegressÃ£o 1: Efeito Total (c)

```{r}
#| echo: true

# Sociabilidade â†’ Treinos (sem mediador)
reg_total <- lm(Treinos ~ Sociabilidade, data = dados)

summary(reg_total)$coefficients %>%
  kable(digits = 3, caption = "Efeito Total (c)")
```

---

### RegressÃ£o 2: Caminho a

```{r}
#| echo: true

# Sociabilidade â†’ IMC
reg_a <- lm(IMC1 ~ Sociabilidade, data = dados)

summary(reg_a)$coefficients %>%
  kable(digits = 3, caption = "Caminho a (X â†’ M)")
```

---

### RegressÃ£o 3: Caminhos b e c'

```{r}
#| echo: true

# IMC + Sociabilidade â†’ Treinos
reg_bc <- lm(Treinos ~ IMC1 + Sociabilidade, data = dados)

summary(reg_bc)$coefficients %>%
  kable(digits = 3, caption = "Caminhos b (M â†’ Y) e c' (X â†’ Y direto)")
```

---

### DiferenÃ§a: SEM vs RegressÃµes

::: {.callout-important}
## Por que SEM Ã© Superior?

**RegressÃµes separadas:**
- âœ“ Estimam a, b, c'
- âœ— **NÃƒO** calculam efeito indireto (a Ã— b)
- âœ— **NÃƒO** fornecem IC para mediaÃ§Ã£o
- âœ— NÃ£o testam significÃ¢ncia da mediaÃ§Ã£o

**SEM (lavaan):**
- âœ“ Estima todos os caminhos
- âœ“ **Calcula efeito indireto** automaticamente
- âœ“ **Bootstrap IC** para a Ã— b
- âœ“ **Teste formal** de mediaÃ§Ã£o

**ConclusÃ£o:** Use SEM para mediaÃ§Ã£o!
:::

---

## ğŸ¯ Modelo 2: Idade como Mediador

::: {.callout-tip}
## Nova HipÃ³tese

**E se:** Sociabilidade â†’ Idade â†’ Treinos?

(HipÃ³tese pouco plausÃ­vel, mas vamos testar!)
:::

```{r}
#| echo: true

modelo_med2 <- "
  Treinos ~ c_*Sociabilidade + b*Idade
  Idade ~ a*Sociabilidade
  
  Indireto := a*b
  Total := a*b + c_
"

fit_med2 <- sem(modelo_med2, data = dados, 
                se = "bootstrap", bootstrap = 500)
```

---

### Resultados - Modelo 2

```{r}
#| echo: true

parameterEstimates(fit_med2) %>%
  filter(op %in% c("~", ":=")) %>%
  dplyr::select(lhs, op, rhs, label, est, se, z, pvalue, ci.lower, ci.upper) %>%
  kable(digits = 3, caption = "MediaÃ§Ã£o via Idade")
```

::: {.callout-note}
## ğŸ“Š Resultado

**Caminhos:**
- **a (Soc â†’ Idade):** p = 0.592 â†’ **NS**
- **b (Idade â†’ Treino):** p = 0.001 â†’ **Sig!**
- **c':** p = 0.384 â†’ **NS**

**Efeito Indireto:** p = 0.605 â†’ **NS**

**ConclusÃ£o:**
Idade prediz Treinos, mas **nÃ£o medeia** efeito de Sociabilidade.
:::

---

### Diagrama - Modelo 2

```{r}
#| echo: true
#| fig-width: 8
#| fig-height: 6

semPaths(
  fit_med2,
  what = "std",
  whatLabels = "std",
  style = "ram",
  layout = "tree",
  rotation = 2,
  sizeMan = 7,
  edge.label.cex = 1,
  color = list(man = "lightyellow")
)
```

---

## ğŸ¯ Modelo 3: IMC â†’ Idade â†’ Treinos

::: {.callout-tip}
## Terceira HipÃ³tese

**Explorando:** IMC â†’ Idade â†’ Treinos

"IMC influencia Treinos **atravÃ©s de** Idade"
:::

```{r}
#| echo: true

modelo_med3 <- "
  Treinos ~ c_*IMC1 + b*Idade
  Idade ~ a*IMC1
  
  Indireto := a*b
  Total := a*b + c_
"

fit_med3 <- sem(modelo_med3, data = dados,
                se = "bootstrap", bootstrap = 500)
```

---

### Resultados - Modelo 3

```{r}
#| echo: true

parameterEstimates(fit_med3) %>%
  filter(op %in% c("~", ":=")) %>%
  dplyr::select(lhs, op, rhs, label, est, se, z, pvalue, ci.lower, ci.upper) %>%
  kable(digits = 3, caption = "MediaÃ§Ã£o: IMC â†’ Idade â†’ Treinos")
```

::: {.callout-tip}
## âœ“ MediaÃ§Ã£o Confirmada!

**Caminhos:**
- **a (IMC â†’ Idade):** Î² = 0.608, p = 0.005 â†’ **Sig!**
- **b (Idade â†’ Treino):** Î² = 1.928, p < 0.001 â†’ **Sig!**
- **c' (IMC â†’ Treino direto):** Î² = -2.778, p = 0.006 â†’ **Sig!**

**Efeito Indireto:** Î² = 1.171, p = 0.030 â†’ **Sig!**

**InterpretaÃ§Ã£o:**
- IMC **negativamente** relacionado a Treinos (direto)
- Mas IMC **positivamente** relacionado a Idade
- E Idade **positivamente** relacionada a Treinos
- **MediaÃ§Ã£o parcial:** Parte do efeito Ã© indireto (via Idade)

**Efeito supressor:** Indireto e direto tÃªm **sinais opostos**!
:::

---

### Diagrama - Modelo 3

```{r}
#| echo: true
#| fig-width: 8
#| fig-height: 6

semPaths(
  fit_med3,
  what = "std",
  whatLabels = "std",
  style = "ram",
  layout = "tree",
  rotation = 2,
  sizeMan = 7,
  edge.label.cex = 1,
  color = list(man = "lightcoral")
)
```

---

## ğŸ“Š AnÃ¡lise Complementar: Pacote `mediation`

```{r}
#| echo: true

# Caminho a
modelo_a <- lm(Idade ~ IMC1, data = dados)

# Caminhos b e c'
modelo_completo <- lm(Treinos ~ Idade + IMC1, data = dados)

# AnÃ¡lise de mediaÃ§Ã£o
resultado_med <- mediate(
  modelo_a,
  modelo_completo,
  treat = "IMC1",
  mediator = "Idade",
  boot = TRUE,
  sims = 500
)

summary(resultado_med)
```

---

### VisualizaÃ§Ã£o da MediaÃ§Ã£o

```{r}
#| echo: true
#| fig-width: 10
#| fig-height: 6

mediate_plot(Treinos ~ Idade + IMC1, data = dados)
```

::: {.callout-tip}
## ğŸ” Interpretando o GrÃ¡fico

**Painel 1 (esquerda):** IMC â†’ Idade (caminho a)  
**Painel 2 (direita):** Idade â†’ Treinos (caminho b)  
**Painel 3 (centro):** IMC â†’ Treinos direto (c')

Linhas mostram relaÃ§Ã£o entre variÃ¡veis, controlando outras.
:::

---

## ğŸ“Š ComparaÃ§Ã£o dos TrÃªs Modelos

```{r}
#| echo: true

# Extrair efeitos indiretos
efeitos <- data.frame(
  Modelo = c(
    "1: Soc â†’ IMC â†’ Treino",
    "2: Soc â†’ Idade â†’ Treino",
    "3: IMC â†’ Idade â†’ Treino"
  ),
  Indireto_Î² = c(
    parameterEstimates(fit_med1)[8, "est"],
    parameterEstimates(fit_med2)[8, "est"],
    parameterEstimates(fit_med3)[8, "est"]
  ),
  Indireto_p = c(
    parameterEstimates(fit_med1)[8, "pvalue"],
    parameterEstimates(fit_med2)[8, "pvalue"],
    parameterEstimates(fit_med3)[8, "pvalue"]
  )
) %>%
  mutate(
    Significativo = ifelse(Indireto_p < 0.05, "âœ“ Sim", "âœ— NÃ£o"),
    across(where(is.numeric), ~round(., 3))
  )

kable(efeitos, caption = "ComparaÃ§Ã£o de Efeitos Indiretos")
```

::: {.callout-note}
## ğŸ† Modelo Vencedor

**Modelo 3** Ã© o Ãºnico com mediaÃ§Ã£o significativa!

**Mensagem:** IMC afeta Treinos tanto:
- **Diretamente** (negativamente)
- **Indiretamente** via Idade (positivamente)

SupressÃ£o: Efeito total pode ser enganoso!
:::

---

## ğŸ“ Conceitos AvanÃ§ados

::: {.callout-tip collapse="true"}
## ğŸ“š Tipos de MediaÃ§Ã£o

**1. MediaÃ§Ã£o Completa**
- c' = 0 (NS)
- Todo efeito via M
- Raro na prÃ¡tica

**2. MediaÃ§Ã£o Parcial**
- c' â‰  0 (Sig)
- Efeito direto + indireto
- Mais comum

**3. MediaÃ§Ã£o Inconsistente**
- c' e (aÃ—b) tÃªm **sinais opostos**
- "SupressÃ£o"
- Modelo 3 Ã© exemplo!

**4. NÃ£o-MediaÃ§Ã£o**
- aÃ—b = 0 (NS)
- M nÃ£o explica X â†’ Y
- Modelos 1 e 2
:::

---

::: {.callout-tip collapse="true"}
## ğŸ—ºï¸ Checklist de MediaÃ§Ã£o

**1. Requisitos TeÃ³ricos**
- [ ] X â†’ M â†’ Y faz sentido temporal
- [ ] M Ã© consequÃªncia de X (nÃ£o prÃ©-existente)
- [ ] Mecanismo plausÃ­vel

**2. Requisitos EstatÃ­sticos**
- [ ] Caminho a significativo (X â†’ M)
- [ ] Caminho b significativo (M â†’ Y, controlando X)
- [ ] Efeito indireto (aÃ—b) significativo

**3. NÃ£o Ã© NecessÃ¡rio**
- âœ— Efeito total (c) ser significativo
- âœ— Baron & Kenny desatualizado!

**4. Bootstrap**
- [ ] Usar bootstrap (â‰¥ 500 simulaÃ§Ãµes)
- [ ] IC nÃ£o contÃ©m zero â†’ mediaÃ§Ã£o

**5. Alternativas**
- [ ] Considerar variÃ¡veis confundidoras
- [ ] Testar mediaÃ§Ã£o reversa
- [ ] AnÃ¡lise de sensibilidade
:::

---

## ğŸ“š Material Complementar

{{< video https://www.youtube.com/watch?v=NstttDePtcM title='SEM - ModeraÃ§Ã£o e MediaÃ§Ã£o - Aula PrÃ¡tica #8.1' >}}

---

### Recursos Adicionais

::: {.callout-note collapse="true"}
## ğŸ“– Aprofundamento

**Tutoriais:**
- [Simple Mediation in R](https://www.youtube.com/watch?v=nfQOCy9xMnk)
- [Dustin Fife - Mediation with Visuals](https://www.youtube.com/watch?v=_4Fu8SZID2k)

**Leituras:**
- Hayes (2017). *Introduction to Mediation, Moderation*
- MacKinnon (2008). *Introduction to Statistical Mediation Analysis*

**TÃ³picos AvanÃ§ados:**
- MediaÃ§Ã£o mÃºltipla (M1, M2...)
- MediaÃ§Ã£o moderada
- MediaÃ§Ã£o multinÃ­vel
- AnÃ¡lise de sensibilidade (Sensitivity analysis)
:::

---

## ğŸ”§ InformaÃ§Ãµes de SessÃ£o

```{r}
report(sessionInfo())
```

---

::: {.callout-note appearance="simple"}
## ğŸ“ Resumo da Lista 8.1

Nesta lista vocÃª:

âœ… Compreendeu **mediaÃ§Ã£o vs moderaÃ§Ã£o**  
âœ… Especificou modelos de **mediaÃ§Ã£o em lavaan**  
âœ… Calculou **efeitos indiretos** com bootstrap  
âœ… Interpretou **caminhos a, b, c, c'**  
âœ… Identificou **mediaÃ§Ã£o parcial** e **supressÃ£o**  
âœ… Comparou **SEM vs regressÃµes** separadas  
âœ… Usou **`mediation` package** para anÃ¡lise complementar  

**Conceitos-chave:**
- MediaÃ§Ã£o explica **como/por que** X afeta Y
- Efeito indireto = a Ã— b
- Bootstrap para IC robusto
- c = c' + (a Ã— b)
- MediaÃ§Ã£o parcial mais comum que completa
- SEM superior a regressÃµes separadas

**AplicaÃ§Ãµes:**
- Testar mecanismos psicolÃ³gicos
- Validar teorias causais
- Identificar variÃ¡veis-alvo para intervenÃ§Ã£o
- AnÃ¡lise de processos mediacionais

**Armadilhas comuns:**
- âœ— Assumir causalidade sem desenho apropriado
- âœ— Ignorar confundidores
- âœ— MediaÃ§Ã£o sem fundamentaÃ§Ã£o teÃ³rica
- âœ— Usar mÃ©todo Baron & Kenny desatualizado
:::

---

::: {.callout-tip appearance="simple"}
## ğŸ‰ ParabÃ©ns!

VocÃª completou **todas as 10 listas** do tutorial de Modelos EstatÃ­sticos em R!

**Jornada percorrida:**
1. âœ“ IntroduÃ§Ã£o e GLM bÃ¡sico
2. âœ“ GEE com diferentes distribuiÃ§Ãµes
3. âœ“ Matrizes de covariÃ¢ncia (GMM)
4. âœ“ Modelos hierÃ¡rquicos e ICC
5. âœ“ Modelos lineares generalizados
6. âœ“ AnÃ¡lise de sobrevida (Kaplan-Meier e Cox)
7. âœ“ Cox tempo-dependente
8. âœ“ SÃ©ries temporais (ARIMA)
9. âœ“ CFA e Path Analysis
10. âœ“ MediaÃ§Ã£o e ModeraÃ§Ã£o

**PrÃ³ximos passos:**
- Aplicar em seus dados reais
- Consultar material complementar
- Contribuir com feedback
- Compartilhar conhecimento!

**Bons estudos e sucesso em suas anÃ¡lises! ğŸ“ŠğŸš€**
:::