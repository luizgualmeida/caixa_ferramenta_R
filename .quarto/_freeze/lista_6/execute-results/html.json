{
  "hash": "867dfd693fcacdaaf4d14cf1dd9c6b92",
  "result": {
    "engine": "knitr",
    "markdown": "# Lista 6: An√°lise de Sobrevida {#sec-lista-6 .unnumbered}\n\n::: {.callout-note appearance=\"simple\" icon=false}\n## Objetivo da Lista\n\nAprenda t√©cnicas de **an√°lise de sobrevida**: construir curvas de **Kaplan-Meier**, comparar grupos com **testes log-rank** e modelar riscos com **Regress√£o de Cox**. Trabalharemos com dados reais de 124 pacientes na fila de transplante renal.\n:::\n\n---\n\n## üìñ Contexto do Estudo\n\n::: {.callout-tip}\n## Dados: Fila de Transplante Renal\n\n**Amostra:** 124 pacientes aguardando transplante de rim\n\n**Vari√°veis:**\n- `t_seg`: Tempo de seguimento (meses)\n- `tx`: Realizou transplante? (sim/n√£o)\n- `obito`: √ìbito do paciente (sim/n√£o) - **evento de interesse**\n- `t_tx`: Tempo at√© o transplante (meses)\n\n**Pergunta:** O transplante afeta a sobrevida dos pacientes?\n:::\n\n---\n\n## üì¶ Pacotes necess√°rios\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacotes <- c(\n  \"tidyverse\", \"foreign\", \"ggplot2\", \"kableExtra\",\n  \"survival\", \"ggsurvfit\", \"survminer\", \"broom\",\n  \"gtsummary\", \"report\", \"coin\"\n)\n\npacotes_faltantes <- pacotes[!pacotes %in% installed.packages()[, \"Package\"]]\nif (length(pacotes_faltantes) > 0) {\n  install.packages(pacotes_faltantes, dependencies = TRUE)\n}\n\ninvisible(lapply(pacotes, library, character.only = TRUE))\ncat(\"‚úì Pacotes de sobrevida carregados!\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n‚úì Pacotes de sobrevida carregados!\n```\n\n\n:::\n:::\n\n\n\n\n\n\n---\n\n## üßπ Boas Pr√°ticas: Ambiente Limpo\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Limpar ambiente\nrm(list = ls(all.names = TRUE))\ngc()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n          used  (Mb) gc trigger  (Mb) max used  (Mb)\nNcells 2605469 139.2    4276531 228.4  4276531 228.4\nVcells 4458572  34.1   10146329  77.5  7235079  55.2\n```\n\n\n:::\n\n```{.r .cell-code}\n# Configura√ß√µes\noptions(max.print = .Machine$integer.max, \n        scipen = 999, \n        stringsAsFactors = FALSE)\n\nset.seed(42)\n```\n:::\n\n\n\n\n\n\n---\n\n## üé® Tema Customizado (Opcional)\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmeu_tema <- theme(\n  plot.title = element_text(size = rel(1.5), face = \"bold\"),\n  panel.grid.major.y = element_line(colour = 'gray90'),\n  panel.grid.minor.y = element_line(colour = 'gray95'),\n  panel.grid.major.x = element_blank(),\n  panel.grid.minor.x = element_blank(),\n  plot.background = element_rect(fill = 'white', colour = 'white'),\n  panel.background = element_rect(fill = 'white'),\n  axis.line = element_line(colour = 'black', linewidth = 0.8),\n  axis.text = element_text(colour = \"black\", face = 'bold'),\n  axis.title = element_text(size = rel(1.2)),\n  axis.ticks = element_line(colour = 'black', linewidth = 0.8),\n  legend.position = \"bottom\",\n  legend.background = element_blank(),\n  legend.box.background = element_rect(colour = \"black\")\n)\n```\n:::\n\n\n\n\n\n\n---\n\n## üì• Prepara√ß√£o dos Dados\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Carregar\noriginal <- read.spss(\"teste Cox tempo dep Tx.sav\", to.data.frame = TRUE)\n\nglimpse(original)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 124\nColumns: 5\n$ id    <chr> \"13758618I                     \", \"13750502G                    ‚Ä¶\n$ t_seg <dbl> 99, 98, 97, 97, 97, 96, 92, 90, 89, 87, 83, 83, 82, 82, 80, 77, ‚Ä¶\n$ t_tx  <dbl> 22, 81, NA, 25, 93, 5, 1, 30, 88, 28, 30, 13, 49, NA, NA, 10, NA‚Ä¶\n$ tx    <fct> sim, sim, n√£o, sim, sim, sim, sim, sim, sim, sim, sim, sim, sim,‚Ä¶\n$ obito <fct> n√£o, n√£o, n√£o, n√£o, n√£o, n√£o, n√£o, n√£o, sim, n√£o, n√£o, n√£o, n√£o,‚Ä¶\n```\n\n\n:::\n:::\n\n\n\n\n\n\n---\n\n### ‚ö†Ô∏è Convers√£o Cr√≠tica: Evento Bin√°rio\n\n::: {.callout-important}\n## Regra Fundamental!\n\nA vari√°vel de **evento** DEVE ser **num√©rica bin√°ria** (0 = censura, 1 = evento).\n\n**N√£o use:** Fatores \"sim\"/\"n√£o\"  \n**Use:** 0 = sem √≥bito (censurado), 1 = com √≥bito (evento)\n:::\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Criar vers√£o corrigida\ndb <- original %>%\n  mutate(obito = as.integer(obito == \"sim\"))\n\n# Verificar\nglimpse(db$obito)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n int [1:124] 0 0 0 0 0 0 0 0 1 0 ...\n```\n\n\n:::\n\n```{.r .cell-code}\ntable(db$obito)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n 0  1 \n90 34 \n```\n\n\n:::\n:::\n\n\n\n\n\n\n---\n\n### An√°lise Explorat√≥ria\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Verificar missing values\ndata.frame(\n  NA_t_seg = sum(is.na(db$t_seg)),\n  NA_t_tx = sum(is.na(db$t_tx)),\n  NA_tx = sum(is.na(db$tx)),\n  NA_obito = sum(is.na(db$obito))\n) %>% kable(caption = \"Dados Faltantes\")\n```\n\n::: {.cell-output-display}\n\n\nTable: Dados Faltantes\n\n| NA_t_seg| NA_t_tx| NA_tx| NA_obito|\n|--------:|-------:|-----:|--------:|\n|        0|      64|     0|        0|\n\n\n:::\n:::\n\n\n\n\n\n\n::: {.callout-note collapse=\"true\"}\n## üìä Interpretando NAs em t_tx\n\n**51.6% de NAs** em `t_tx` √© **esperado**! Representa pacientes que **n√£o** fizeram transplante.\n\n**Verifica√ß√£o:** Nenhum paciente com tx=\"sim\" deveria ter NA em t_tx.\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Verificar inconsist√™ncias\ndb %>% filter(tx == \"sim\" & is.na(t_tx))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] id    t_seg t_tx  tx    obito\n<0 linhas> (ou row.names de comprimento 0)\n```\n\n\n:::\n:::\n\n\n\n\n\n\nSe retornar 0 linhas ‚Üí OK!\n:::\n\n---\n\n## üéØ Estrutura de Dados de Sobrevida\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Criar objeto Surv\nsurv_obj <- Surv(time = db$t_seg, event = db$obito)\n\n# Visualizar primeiros casos\nhead(surv_obj)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 99+ 98+ 97+ 97+ 97+ 96+\n```\n\n\n:::\n:::\n\n\n\n\n\n\n::: {.callout-tip}\n## üîç Interpretando a Nota√ß√£o\n\n- **34:** Tempo 34, evento ocorreu\n- **58+:** Tempo 58, **censurado** (+ indica censura)\n\n**Censura** = paciente saiu do estudo sem evento (perdeu acompanhamento, fim do estudo, etc.)\n:::\n\n---\n\n## üìä Parte A: T√°bua de Vida\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Modelo geral (sem grupos)\nfit1 <- survfit(surv_obj ~ 1, data = db)\n\n# Resumo\nsummary(fit1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCall: survfit(formula = surv_obj ~ 1, data = db)\n\n time n.risk n.event survival std.err lower 95% CI upper 95% CI\n    0    124       2    0.984  0.0113        0.962        1.000\n    3    121       2    0.968  0.0159        0.937        0.999\n    4    119       2    0.951  0.0194        0.914        0.990\n    6    117       1    0.943  0.0208        0.903        0.985\n    8    116       2    0.927  0.0234        0.882        0.974\n   11    114       1    0.919  0.0246        0.872        0.968\n   13    113       1    0.911  0.0257        0.862        0.962\n   16    110       1    0.902  0.0268        0.851        0.956\n   19    108       1    0.894  0.0278        0.841        0.950\n   24    106       2    0.877  0.0297        0.821        0.937\n   25    104       1    0.869  0.0306        0.811        0.931\n   26    103       1    0.860  0.0314        0.801        0.924\n   27    102       1    0.852  0.0323        0.791        0.917\n   29    101       1    0.843  0.0330        0.781        0.911\n   34     89       3    0.815  0.0358        0.748        0.888\n   36     82       1    0.805  0.0367        0.736        0.880\n   38     70       1    0.794  0.0379        0.723        0.871\n   40     68       1    0.782  0.0391        0.709        0.862\n   41     65       2    0.758  0.0414        0.681        0.844\n   44     59       1    0.745  0.0427        0.666        0.834\n   45     55       1    0.731  0.0440        0.650        0.823\n   46     53       1    0.718  0.0453        0.634        0.812\n   49     47       1    0.702  0.0468        0.616        0.800\n   58     32       1    0.680  0.0502        0.589        0.786\n   66     24       1    0.652  0.0556        0.552        0.771\n   89      9       1    0.580  0.0843        0.436        0.771\n```\n\n\n:::\n:::\n\n\n\n\n\n\n---\n\n### Tabela Formatada\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntidy_survfit(fit1) %>%\n  head(10) %>%\n  kable(digits = 3, caption = \"Primeiras 10 Linhas da T√°bua de Vida\")\n```\n\n::: {.cell-output-display}\n\n\nTable: Primeiras 10 Linhas da T√°bua de Vida\n\n| time| n.risk| n.event| n.censor| cum.event| cum.censor| estimate| std.error| conf.high| conf.low|estimate_type |estimate_type_label  |monotonicity_type | conf.level|\n|----:|------:|-------:|--------:|---------:|----------:|--------:|---------:|---------:|--------:|:-------------|:--------------------|:-----------------|----------:|\n|    0|    124|       2|        1|         2|          1|    0.984|     0.011|     1.000|    0.962|survival      |Survival Probability |decreasing        |       0.95|\n|    3|    121|       2|        0|         4|          1|    0.968|     0.016|     0.999|    0.937|survival      |Survival Probability |decreasing        |       0.95|\n|    4|    119|       2|        0|         6|          1|    0.951|     0.020|     0.990|    0.914|survival      |Survival Probability |decreasing        |       0.95|\n|    6|    117|       1|        0|         7|          1|    0.943|     0.022|     0.985|    0.903|survival      |Survival Probability |decreasing        |       0.95|\n|    8|    116|       2|        0|         9|          1|    0.927|     0.025|     0.974|    0.882|survival      |Survival Probability |decreasing        |       0.95|\n|   11|    114|       1|        0|        10|          1|    0.919|     0.027|     0.968|    0.872|survival      |Survival Probability |decreasing        |       0.95|\n|   13|    113|       1|        0|        11|          1|    0.911|     0.028|     0.962|    0.862|survival      |Survival Probability |decreasing        |       0.95|\n|   14|    112|       0|        1|        11|          2|    0.911|     0.028|     0.962|    0.862|survival      |Survival Probability |decreasing        |       0.95|\n|   15|    111|       0|        1|        11|          3|    0.911|     0.028|     0.962|    0.862|survival      |Survival Probability |decreasing        |       0.95|\n|   16|    110|       1|        0|        12|          3|    0.902|     0.030|     0.956|    0.851|survival      |Survival Probability |decreasing        |       0.95|\n\n\n:::\n:::\n\n\n\n\n\n\n---\n\n## üìà Parte B: Curva de Kaplan-Meier\n\n### Curva Geral\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggsurvfit(fit1, linewidth = 1.2) +\n  labs(\n    title = \"Curva de Sobrevida Geral\",\n    x = \"Tempo (meses)\",\n    y = \"Probabilidade de Sobrevida\"\n  ) +\n  add_confidence_interval(alpha = 0.2) +\n  add_risktable() +\n  scale_ggsurvfit() +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](lista_6_files/figure-html/unnamed-chunk-11-1.png){width=960}\n:::\n:::\n\n\n\n\n\n\n---\n\n### Comparando Grupos: Transplante vs N√£o-Transplante\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Modelo com grupos\nfit2 <- survfit(surv_obj ~ tx, data = db)\n\n# Resumo em tempos espec√≠ficos\ntempos <- seq(0, 100, by = 20)\nsummary(fit2, times = tempos)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCall: survfit(formula = surv_obj ~ tx, data = db)\n\n                tx=sim \n time n.risk n.event survival std.err lower 95% CI upper 95% CI\n    0     60       0    1.000  0.0000        1.000        1.000\n   20     57       2    0.966  0.0236        0.921        1.000\n   40     42       4    0.894  0.0410        0.818        0.978\n   60     21       3    0.823  0.0550        0.722        0.938\n   80     12       1    0.779  0.0670        0.658        0.922\n\n                tx=n√£o \n time n.risk n.event survival std.err lower 95% CI upper 95% CI\n    0     64       2    0.969  0.0217        0.927        1.000\n   20     50       9    0.827  0.0476        0.738        0.925\n   40     26       8    0.668  0.0643        0.553        0.806\n   60      7       4    0.523  0.0841        0.382        0.717\n   80      3       0    0.523  0.0841        0.382        0.717\n```\n\n\n:::\n:::\n\n\n\n\n\n\n---\n\n### Visualiza√ß√£o Comparativa\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit2_km <- ggsurvfit(fit2, linewidth = 1.2) +\n  labs(\n    title = \"Sobrevida: Transplante vs N√£o-Transplante\",\n    x = \"Tempo (meses)\",\n    y = \"Probabilidade de Sobrevida (%)\"\n  ) +\n  add_confidence_interval(alpha = 0.2) +\n  add_risktable() +\n  scale_ggsurvfit() +\n  theme_minimal()\n\nfit2_km\n```\n\n::: {.cell-output-display}\n![](lista_6_files/figure-html/unnamed-chunk-13-1.png){width=960}\n:::\n:::\n\n\n\n\n\n\n---\n\n### An√°lise em Tempo Espec√≠fico\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Sobrevida aos 75 meses\nsurv_75 <- summary(fit2, times = 75)\n\ncat(\"‚ïê‚ïê‚ïê SOBREVIDA AOS 75 MESES ‚ïê‚ïê‚ïê\\n\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n‚ïê‚ïê‚ïê SOBREVIDA AOS 75 MESES ‚ïê‚ïê‚ïê\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Transplante = SIM:\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nTransplante = SIM:\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"  Sobrevida:\", round(surv_75$surv[1], 3), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  Sobrevida: 0.779 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"  IC 95%: [\", round(surv_75$lower[1], 3), \",\",\n    round(surv_75$upper[1], 3), \"]\\n\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  IC 95%: [ 0.658 , 0.922 ]\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Transplante = N√ÉO:\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nTransplante = N√ÉO:\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"  Sobrevida:\", round(surv_75$surv[2], 3), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  Sobrevida: 0.523 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"  IC 95%: [\", round(surv_75$lower[2], 3), \",\",\n    round(surv_75$upper[2], 3), \"]\\n\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  IC 95%: [ 0.382 , 0.717 ]\n```\n\n\n:::\n\n```{.r .cell-code}\n# Raz√£o\nrazao <- surv_75$surv[1] / surv_75$surv[2]\ncat(\"Raz√£o (Sim/N√£o):\", round(razao, 2), \"√ó\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRaz√£o (Sim/N√£o): 1.49 √ó\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"‚Üí Grupo com transplante tem\", round(razao, 2), \n    \"√ó mais chance de estar vivo aos 75 meses\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n‚Üí Grupo com transplante tem 1.49 √ó mais chance de estar vivo aos 75 meses\n```\n\n\n:::\n:::\n\n\n\n\n\n\n---\n\n### Gr√°fico com Marca√ß√£o de Tempo\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit2_km +\n  geom_vline(xintercept = 75, linetype = 'dashed', \n             colour = 'red', linewidth = 1) +\n  geom_hline(yintercept = surv_75$surv, linetype = 'dashed',\n             colour = 'red', linewidth = 1) +\n  annotate(\"text\", x = 77, y = 0.9, label = \"75 meses\",\n           hjust = 0, color = \"red\", fontface = \"bold\")\n```\n\n::: {.cell-output-display}\n![](lista_6_files/figure-html/unnamed-chunk-15-1.png){width=960}\n:::\n:::\n\n\n\n\n\n\n---\n\n### Percentil Fixo: Tempo para 75% de Sobrevida\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit2 %>%\n  ggsurvfit(linewidth = 1.2) +\n  labs(\n    title = \"Tempo at√© 75% de Sobrevida\",\n    x = \"Tempo (meses)\",\n    y = \"Probabilidade de Sobrevida\"\n  ) +\n  add_confidence_interval(alpha = 0.2) +\n  add_quantile(y_value = 0.75, color = \"gray30\", linewidth = 0.8) +\n  scale_ggsurvfit() +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](lista_6_files/figure-html/unnamed-chunk-16-1.png){width=960}\n:::\n:::\n\n\n\n\n\n\n::: {.callout-note}\n## üìä Interpreta√ß√£o\n\n- **Sem transplante:** Atinge 75% de sobrevida ~35 meses\n- **Com transplante:** Atinge 75% de sobrevida ~90 meses\n\nTransplante **mais que dobra** o tempo para atingir esse patamar!\n:::\n\n---\n\n## üî¨ Compara√ß√£o de Curvas: Testes Estat√≠sticos\n\n::: {.callout-tip}\n## Escolhendo o Teste Certo\n\n- **Log-rank:** Diferen√ßas ao longo de **todo** o per√≠odo (padr√£o)\n- **Gehan-Breslow:** Enfatiza diferen√ßas **iniciais**\n- **Tarone-Ware:** Peso intermedi√°rio\n- **Peto-Peto:** Similar ao log-rank, robusto\n\n**Regra geral:** Use log-rank a menos que haja raz√£o espec√≠fica.\n:::\n\n---\n\n### Log-Rank (Mantel-Cox)\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlogrank_test(surv_obj ~ tx, data = db, type = \"logrank\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tAsymptotic Two-Sample Logrank Test\n\ndata:  surv_obj by tx (sim, n√£o)\nZ = 2.9275, p-value = 0.003417\nalternative hypothesis: true theta is not equal to 1\n```\n\n\n:::\n:::\n\n\n\n\n\n\n---\n\n### Gehan-Breslow\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlogrank_test(surv_obj ~ tx, data = db, type = \"Gehan-Breslow\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tAsymptotic Two-Sample Gehan-Breslow Test\n\ndata:  surv_obj by tx (sim, n√£o)\nZ = 3.0103, p-value = 0.00261\nalternative hypothesis: true theta is not equal to 1\n```\n\n\n:::\n:::\n\n\n\n\n\n\n---\n\n### Tarone-Ware\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlogrank_test(surv_obj ~ tx, data = db, type = \"Tarone-Ware\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tAsymptotic Two-Sample Tarone-Ware Test\n\ndata:  surv_obj by tx (sim, n√£o)\nZ = 3.0338, p-value = 0.002415\nalternative hypothesis: true theta is not equal to 1\n```\n\n\n:::\n:::\n\n\n\n\n\n\n---\n\n::: {.callout-note}\n## üìä Conclus√£o dos Testes\n\nTodos os testes indicam **p < 0.05**, rejeitando H‚ÇÄ.\n\n**Conclus√£o:** H√° evid√™ncia significativa de que as curvas de sobrevida diferem entre grupos com e sem transplante.\n:::\n\n---\n\n## üéØ Parte C: Regress√£o de Cox\n\n::: {.callout-tip}\n## O que √© Regress√£o de Cox?\n\nModelo **semi-param√©trico** que estima o **risco instant√¢neo** (hazard) de um evento ao longo do tempo.\n\n**Vantagens:**\n- Permite m√∫ltiplas covari√°veis\n- N√£o assume distribui√ß√£o espec√≠fica do tempo\n- Estima **Hazard Ratios** (HR)\n\n**HR interpreta√ß√£o:**\n- HR = 1: Sem efeito\n- HR > 1: Aumenta risco\n- HR < 1: Diminui risco (prote√ß√£o)\n:::\n\n---\n\n### Ajuste do Modelo\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Modelo Cox\ncox_res <- coxph(surv_obj ~ tx, data = db)\n\n# Resumo\nsummary(cox_res)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCall:\ncoxph(formula = surv_obj ~ tx, data = db)\n\n  n= 124, number of events= 34 \n\n        coef exp(coef) se(coef)     z Pr(>|z|)   \ntxn√£o 1.0787    2.9409   0.3753 2.874  0.00405 **\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n      exp(coef) exp(-coef) lower .95 upper .95\ntxn√£o     2.941       0.34     1.409     6.136\n\nConcordance= 0.638  (se = 0.04 )\nLikelihood ratio test= 8.99  on 1 df,   p=0.003\nWald test            = 8.26  on 1 df,   p=0.004\nScore (logrank) test = 9.01  on 1 df,   p=0.003\n```\n\n\n:::\n:::\n\n\n\n\n\n\n---\n\n### Tabela Formatada para Publica√ß√£o\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntbl_regression(\n  cox_res,\n  exponentiate = TRUE,\n  label = list(tx ~ \"Transplante\")\n) %>%\n  bold_p() %>%\n  add_global_p()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"qeayjdrzqo\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#qeayjdrzqo table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#qeayjdrzqo thead, #qeayjdrzqo tbody, #qeayjdrzqo tfoot, #qeayjdrzqo tr, #qeayjdrzqo td, #qeayjdrzqo th {\n  border-style: none;\n}\n\n#qeayjdrzqo p {\n  margin: 0;\n  padding: 0;\n}\n\n#qeayjdrzqo .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#qeayjdrzqo .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#qeayjdrzqo .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#qeayjdrzqo .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#qeayjdrzqo .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#qeayjdrzqo .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#qeayjdrzqo .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#qeayjdrzqo .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#qeayjdrzqo .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#qeayjdrzqo .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#qeayjdrzqo .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#qeayjdrzqo .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#qeayjdrzqo .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#qeayjdrzqo .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#qeayjdrzqo .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#qeayjdrzqo .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#qeayjdrzqo .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#qeayjdrzqo .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#qeayjdrzqo .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#qeayjdrzqo .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#qeayjdrzqo .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#qeayjdrzqo .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#qeayjdrzqo .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#qeayjdrzqo .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#qeayjdrzqo .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#qeayjdrzqo .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#qeayjdrzqo .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#qeayjdrzqo .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#qeayjdrzqo .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#qeayjdrzqo .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#qeayjdrzqo .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#qeayjdrzqo .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#qeayjdrzqo .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#qeayjdrzqo .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#qeayjdrzqo .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#qeayjdrzqo .gt_left {\n  text-align: left;\n}\n\n#qeayjdrzqo .gt_center {\n  text-align: center;\n}\n\n#qeayjdrzqo .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#qeayjdrzqo .gt_font_normal {\n  font-weight: normal;\n}\n\n#qeayjdrzqo .gt_font_bold {\n  font-weight: bold;\n}\n\n#qeayjdrzqo .gt_font_italic {\n  font-style: italic;\n}\n\n#qeayjdrzqo .gt_super {\n  font-size: 65%;\n}\n\n#qeayjdrzqo .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#qeayjdrzqo .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#qeayjdrzqo .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#qeayjdrzqo .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#qeayjdrzqo .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#qeayjdrzqo .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#qeayjdrzqo .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#qeayjdrzqo .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#qeayjdrzqo div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"label\"><span data-qmd-base64=\"PHN0cm9uZz5DaGFyYWN0ZXJpc3RpYzwvc3Ryb25nPg==\"><span class='gt_from_md'><strong>Characteristic</strong></span></span></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"estimate\"><span data-qmd-base64=\"PHN0cm9uZz5IUjwvc3Ryb25nPg==\"><span class='gt_from_md'><strong>HR</strong></span></span></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"conf.low\"><span data-qmd-base64=\"PHN0cm9uZz45NSUgQ0k8L3N0cm9uZz4=\"><span class='gt_from_md'><strong>95% CI</strong></span></span></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"p.value\"><span data-qmd-base64=\"PHN0cm9uZz5wLXZhbHVlPC9zdHJvbmc+\"><span class='gt_from_md'><strong>p-value</strong></span></span></th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Transplante</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\"><br /></td>\n<td headers=\"conf.low\" class=\"gt_row gt_center\"><br /></td>\n<td headers=\"p.value\" class=\"gt_row gt_center\" style=\"font-weight: bold;\">0.003</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">¬†¬†¬†¬†sim</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">‚Äî</td>\n<td headers=\"conf.low\" class=\"gt_row gt_center\">‚Äî</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><br /></td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">¬†¬†¬†¬†n√£o</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">2.94</td>\n<td headers=\"conf.low\" class=\"gt_row gt_center\">1.41, 6.14</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><br /></td></tr>\n  </tbody>\n  <tfoot class=\"gt_sourcenotes\">\n    <tr>\n      <td class=\"gt_sourcenote\" colspan=\"4\"><span data-qmd-base64=\"QWJicmV2aWF0aW9uczogQ0kgPSBDb25maWRlbmNlIEludGVydmFsLCBIUiA9IEhhemFyZCBSYXRpbw==\"><span class='gt_from_md'>Abbreviations: CI = Confidence Interval, HR = Hazard Ratio</span></span></td>\n    </tr>\n  </tfoot>\n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\n\n\n\n\n::: {.callout-note}\n## üìä Interpreta√ß√£o\n\n**HR = 2.94** para tx=\"n√£o\"\n\n\"Pacientes **sem transplante** t√™m **2.94√ó mais risco** de √≥bito comparado aos que fizeram transplante\"\n\nEquivalente: Transplante **reduz risco em 66%** [(1 - 1/2.94) √ó 100]\n:::\n\n---\n\n### Curvas Ajustadas pelo Modelo\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Prever para ambos os grupos\ntx_df <- data.frame(tx = c(\"sim\", \"n√£o\"))\ncox_pred <- survfit(cox_res, newdata = tx_df)\n\nggsurvplot(\n  cox_pred,\n  data = db,\n  conf.int = TRUE,\n  legend.labs = c(\"Transplante = Sim\", \"Transplante = N√£o\"),\n  ggtheme = theme_minimal(),\n  title = \"Curvas de Sobrevida Ajustadas (Modelo Cox)\"\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\n‚Ñπ Please use `linewidth` instead.\n‚Ñπ The deprecated feature was likely used in the ggpubr package.\n  Please report the issue at <https://github.com/kassambara/ggpubr/issues>.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](lista_6_files/figure-html/unnamed-chunk-22-1.png){width=960}\n:::\n:::\n\n\n\n\n\n\n::: {.callout-warning}\n## ‚ö†Ô∏è Cox vs Kaplan-Meier\n\nAs curvas do **modelo Cox** s√£o **ajustadas** e podem diferir ligeiramente das curvas Kaplan-Meier **emp√≠ricas**. Isso √© normal!\n\n- **K-M:** Dados brutos, n√£o-param√©trico\n- **Cox:** Modelo ajustado, assume proporcionalidade\n:::\n\n---\n\n### Forest Plot do Modelo\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggforest(cox_res, data = db)\n```\n\n::: {.cell-output-display}\n![](lista_6_files/figure-html/unnamed-chunk-23-1.png){width=960}\n:::\n:::\n\n\n\n\n\n\n---\n\n## üìê Parte D: Calculando Hazard Ratio em Tempo Espec√≠fico\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Especificando o modelo \n\ncox_res <- coxph(Surv(time = t_seg, event = obito) ~ tx, data = db)\n\n# Criar dados para predi√ß√£o (tempo 50 meses)\npred_dat <- data.frame(t_seg = c(50,50),\n                       obito = c(0,0), \n                       tx = c(\"sim\",\"n√£o\")\n                       )\n\nkable(pred_dat)\n```\n\n::: {.cell-output-display}\n\n\n| t_seg| obito|tx  |\n|-----:|-----:|:---|\n|    50|     0|sim |\n|    50|     0|n√£o |\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Prever sobrevida\npreds <- predict(cox_res,\n                 pred_dat, \n                 type = \"survival\", \n                 se.fit = TRUE)\n\n# Adicionar ao dataframe\npred_dat$prob <- preds$fit\npred_dat$lcl <- preds$fit - 1.96 * preds$se.fit\npred_dat$ucl <- preds$fit + 1.96 * preds$se.fit\n\n# Exibir\nkable(pred_dat, digits = 3, caption = \"Sobrevida Predita aos 50 meses\")\n```\n\n::: {.cell-output-display}\n\n\nTable: Sobrevida Predita aos 50 meses\n\n| t_seg| obito|tx  |  prob|   lcl|   ucl|\n|-----:|-----:|:---|-----:|-----:|-----:|\n|    50|     0|sim | 0.825| 0.725| 0.924|\n|    50|     0|n√£o | 0.567| 0.423| 0.711|\n\n\n:::\n\n```{.r .cell-code}\n# HR\nHR_50 <- pred_dat$prob[1] / pred_dat$prob[2]\ncat(\"\\nHR aos 50 meses:\", round(HR_50, 3), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nHR aos 50 meses: 1.454 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"‚Üí Grupo com transplante tem\", round(HR_50, 2), \n    \"√ó mais sobrevida que grupo sem transplante\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n‚Üí Grupo com transplante tem 1.45 √ó mais sobrevida que grupo sem transplante\n```\n\n\n:::\n:::\n\n\n\n\n\n\n---\n\n### HR em M√∫ltiplos Tempos\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# M√∫ltiplos tempos\ntempos_interesse <- c(30, 50, 75, 90)\nresultados_hr <- data.frame()\n\nfor (t in tempos_interesse) {\n  pred_temp <- data.frame(\n    t_seg = c(t, t),\n    obito = c(0, 0),\n    tx = c(\"sim\", \"n√£o\")\n  )\n  \n  preds_temp <- predict(cox_res, newdata = pred_temp, \n                        type = \"survival\", se.fit = TRUE)\n  \n  hr <- preds_temp$fit[1] / preds_temp$fit[2]\n  \n  resultados_hr <- rbind(resultados_hr, data.frame(\n    Tempo = t,\n    Sobrevida_Sim = round(preds_temp$fit[1], 3),\n    Sobrevida_N√£o = round(preds_temp$fit[2], 3),\n    HR = round(hr, 3)\n  ))\n}\n\nkable(resultados_hr, caption = \"Hazard Ratios ao Longo do Tempo\")\n```\n\n::: {.cell-output-display}\n\n\nTable: Hazard Ratios ao Longo do Tempo\n\n| Tempo| Sobrevida_Sim| Sobrevida_N√£o|    HR|\n|-----:|-------------:|-------------:|-----:|\n|    30|         0.917|         0.774| 1.184|\n|    50|         0.825|         0.567| 1.454|\n|    75|         0.786|         0.492| 1.598|\n|    90|         0.717|         0.376| 1.908|\n\n\n:::\n:::\n\n\n\n\n\n\n---\n\n## ‚úÖ Verifica√ß√£o de Pressupostos\n\n::: {.callout-important}\n## Pressuposto Principal: Proporcionalidade dos Riscos\n\nO modelo Cox assume que o **hazard ratio √© constante** ao longo do tempo.\n\n**Viola√ß√£o:** Se HR muda com o tempo, use modelo estratificado ou tempo-dependente.\n:::\n\n---\n\n### 1. Inspe√ß√£o Visual: Curvas Paralelas?\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit2_km +\n  labs(subtitle = \"Curvas paralelas? ‚Üí Riscos proporcionais ‚úì\")\n```\n\n::: {.cell-output-display}\n![](lista_6_files/figure-html/unnamed-chunk-27-1.png){width=960}\n:::\n:::\n\n\n\n\n\n\n::: {.callout-note}\nSe curvas **cruzam**, h√° viola√ß√£o! Neste caso, s√£o aproximadamente paralelas ‚Üí OK.\n:::\n\n---\n\n### 2. Teste de Schoenfeld\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Teste formal\ntest_schoenfeld <- cox.zph(cox_res)\nprint(test_schoenfeld)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       chisq df    p\ntx      0.58  1 0.45\nGLOBAL  0.58  1 0.45\n```\n\n\n:::\n:::\n\n\n\n\n\n\n::: {.callout-tip}\n## Interpretando o Teste\n\n**H‚ÇÄ:** Riscos s√£o proporcionais  \n**p > 0.05:** N√£o rejeitamos H‚ÇÄ ‚Üí Proporcionalidade mantida ‚úì\n\n**Neste caso:** p = 0.43 ‚Üí Pressuposto atendido!\n:::\n\n---\n\n### Gr√°fico de Res√≠duos\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggcoxzph(test_schoenfeld, point.size = 0.5)\n```\n\n::: {.cell-output-display}\n![](lista_6_files/figure-html/unnamed-chunk-29-1.png){width=960}\n:::\n:::\n\n\n\n\n\n\n::: {.callout-note collapse=\"true\"}\n## üîç Interpretando Res√≠duos de Schoenfeld\n\n**O que procurar:**\n- **Sem padr√£o:** Res√≠duos aleat√≥rios ao redor de zero ‚Üí Bom!\n- **Tend√™ncia linear:** Viola√ß√£o da proporcionalidade\n- **Padr√£o n√£o-linear:** Viola√ß√£o severa\n\n**Linha de suaviza√ß√£o:**\n- Aproximadamente horizontal ‚Üí Proporcionalidade OK\n- Inclina√ß√£o clara ‚Üí Problema!\n:::\n\n---\n\n## üìö Material Complementar\n\n\n\n\n\n\n{{< video https://www.youtube.com/watch?v=oyhA4EiE1eM title='An√°lise Sobrevida I - Kaplan-Meier e Cox - Aula Pr√°tica #6' >}}\n\n\n\n\n\n\n\n\n\n\n---\n\n## üîß Informa√ß√µes de Sess√£o\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nreport(sessionInfo())\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalyses were conducted using the R Statistical language (version 4.4.2; R Core\nTeam, 2024) on Windows 11 x64 (build 26100), using the packages lubridate\n(version 1.9.4; Grolemund G, Wickham H, 2011), coin (version 1.4.3; Hothorn T\net al., 2006), ggpubr (version 0.6.0; Kassambara A, 2023), survminer (version\n0.5.1; Kassambara A et al., 2025), report (version 0.6.3; Makowski D et al.,\n2023), tibble (version 3.3.1; M√ºller K, Wickham H, 2026), foreign (version\n0.8.87; R Core Team, 2024), broom (version 1.0.7; Robinson D et al., 2024),\nggsurvfit (version 1.2.0; Sjoberg D et al., 2025), gtsummary (version 2.1.0;\nSjoberg D et al., 2021), survival (version 3.7.0; Therneau T, 2024), ggplot2\n(version 4.0.1; Wickham H, 2016), forcats (version 1.0.0; Wickham H, 2023),\nstringr (version 1.5.1; Wickham H, 2023), tidyverse (version 2.0.0; Wickham H\net al., 2019), dplyr (version 1.1.4; Wickham H et al., 2023), purrr (version\n1.0.4; Wickham H, Henry L, 2025), readr (version 2.1.5; Wickham H et al.,\n2024), tidyr (version 1.3.1; Wickham H et al., 2024) and kableExtra (version\n1.4.0; Zhu H, 2024).\n\nReferences\n----------\n  - Grolemund G, Wickham H (2011). \"Dates and Times Made Easy with lubridate.\"\n_Journal of Statistical Software_, *40*(3), 1-25.\n<https://www.jstatsoft.org/v40/i03/>.\n  - Hothorn T, Hornik K, van de Wiel MA, Zeileis A (2006). \"A Lego system for\nconditional inference.\" _The American Statistician_, *60*(3), 257-263.\ndoi:10.1198/000313006X118430 <https://doi.org/10.1198/000313006X118430>.\nHothorn T, Hornik K, van de Wiel MA, Zeileis A (2008). \"Implementing a class of\npermutation tests: The coin package.\" _Journal of Statistical Software_,\n*28*(8), 1-23. doi:10.18637/jss.v028.i08\n<https://doi.org/10.18637/jss.v028.i08>.\n  - Kassambara A (2023). _ggpubr: 'ggplot2' Based Publication Ready Plots_. R\npackage version 0.6.0, <https://CRAN.R-project.org/package=ggpubr>.\n  - Kassambara A, Kosinski M, Biecek P (2025). _survminer: Drawing Survival\nCurves using 'ggplot2'_. R package version 0.5.1,\n<https://CRAN.R-project.org/package=survminer>.\n  - Makowski D, L√ºdecke D, Patil I, Th√©riault R, Ben-Shachar M, Wiernik B (2023).\n\"Automated Results Reporting as a Practical Tool to Improve Reproducibility and\nMethodological Best Practices Adoption.\" _CRAN_.\ndoi:10.32614/CRAN.package.report\n<https://doi.org/10.32614/CRAN.package.report>,\n<https://easystats.github.io/report/>.\n  - M√ºller K, Wickham H (2026). _tibble: Simple Data Frames_. R package version\n3.3.1, <https://CRAN.R-project.org/package=tibble>.\n  - R Core Team (2024). _foreign: Read Data Stored by 'Minitab', 'S', 'SAS',\n'SPSS', 'Stata', 'Systat', 'Weka', 'dBase', ..._. R package version 0.8-87,\n<https://CRAN.R-project.org/package=foreign>.\n  - R Core Team (2024). _R: A Language and Environment for Statistical\nComputing_. R Foundation for Statistical Computing, Vienna, Austria.\n<https://www.R-project.org/>.\n  - Robinson D, Hayes A, Couch S (2024). _broom: Convert Statistical Objects into\nTidy Tibbles_. R package version 1.0.7,\n<https://CRAN.R-project.org/package=broom>.\n  - Sjoberg D, Baillie M, Fruechtenicht C, Haesendonckx S, Treis T (2025).\n_ggsurvfit: Flexible Time-to-Event Figures_. R package version 1.2.0,\n<https://CRAN.R-project.org/package=ggsurvfit>.\n  - Sjoberg D, Whiting K, Curry M, Lavery J, Larmarange J (2021). \"Reproducible\nSummary Tables with the gtsummary Package.\" _The R Journal_, *13*, 570-580.\ndoi:10.32614/RJ-2021-053 <https://doi.org/10.32614/RJ-2021-053>,\n<https://doi.org/10.32614/RJ-2021-053>.\n  - Therneau T (2024). _A Package for Survival Analysis in R_. R package version\n3.7-0, <https://CRAN.R-project.org/package=survival>. Terry M. Therneau,\nPatricia M. Grambsch (2000). _Modeling Survival Data: Extending the Cox Model_.\nSpringer, New York. ISBN 0-387-98784-3.\n  - Wickham H (2016). _ggplot2: Elegant Graphics for Data Analysis_.\nSpringer-Verlag New York. ISBN 978-3-319-24277-4,\n<https://ggplot2.tidyverse.org>.\n  - Wickham H (2023). _forcats: Tools for Working with Categorical Variables\n(Factors)_. R package version 1.0.0,\n<https://CRAN.R-project.org/package=forcats>.\n  - Wickham H (2023). _stringr: Simple, Consistent Wrappers for Common String\nOperations_. R package version 1.5.1,\n<https://CRAN.R-project.org/package=stringr>.\n  - Wickham H, Averick M, Bryan J, Chang W, McGowan LD, Fran√ßois R, Grolemund G,\nHayes A, Henry L, Hester J, Kuhn M, Pedersen TL, Miller E, Bache SM, M√ºller K,\nOoms J, Robinson D, Seidel DP, Spinu V, Takahashi K, Vaughan D, Wilke C, Woo K,\nYutani H (2019). \"Welcome to the tidyverse.\" _Journal of Open Source Software_,\n*4*(43), 1686. doi:10.21105/joss.01686 <https://doi.org/10.21105/joss.01686>.\n  - Wickham H, Fran√ßois R, Henry L, M√ºller K, Vaughan D (2023). _dplyr: A Grammar\nof Data Manipulation_. R package version 1.1.4,\n<https://CRAN.R-project.org/package=dplyr>.\n  - Wickham H, Henry L (2025). _purrr: Functional Programming Tools_. R package\nversion 1.0.4, <https://CRAN.R-project.org/package=purrr>.\n  - Wickham H, Hester J, Bryan J (2024). _readr: Read Rectangular Text Data_. R\npackage version 2.1.5, <https://CRAN.R-project.org/package=readr>.\n  - Wickham H, Vaughan D, Girlich M (2024). _tidyr: Tidy Messy Data_. R package\nversion 1.3.1, <https://CRAN.R-project.org/package=tidyr>.\n  - Zhu H (2024). _kableExtra: Construct Complex Table with 'kable' and Pipe\nSyntax_. R package version 1.4.0,\n<https://CRAN.R-project.org/package=kableExtra>.\n```\n\n\n:::\n:::\n\n\n\n\n\n\n---\n\n::: {.callout-note appearance=\"simple\"}\n## üéì Resumo da Lista 6\n\nNesta lista voc√™:\n\n‚úÖ Construiu **t√°buas de vida** e curvas **Kaplan-Meier**  \n‚úÖ Comparou grupos com **testes log-rank**  \n‚úÖ Ajustou **Regress√£o de Cox** e interpretou **Hazard Ratios**  \n‚úÖ Calculou HR em **tempos espec√≠ficos**  \n‚úÖ Verificou **proporcionalidade dos riscos**  \n\n**Conceitos-chave:**\n- Censura: dado incompleto (n√£o √© perda de dados!)\n- K-M: m√©todo n√£o-param√©trico para sobrevida\n- Cox: modelo semi-param√©trico para riscos\n- HR: raz√£o de riscos instant√¢neos\n- Proporcionalidade: HR constante ao longo do tempo\n\n**Pr√≥ximos passos:**\n- Lista 7: Cox com covari√°veis **tempo-dependentes**\n- Explorar modelos com m√∫ltiplas covari√°veis\n- An√°lises estratificadas para viola√ß√µes de proporcionalidade\n:::",
    "supporting": [
      "lista_6_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}